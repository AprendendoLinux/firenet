<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireNet Telecom - Internet de Alta Velocidade</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Meta Tags Gerais -->
    <meta name="description" content="A FireNet Telecom oferece internet de alta velocidade com planos de até 800 MEGA. Conexão estável e rápida para Pilares, Inhaúma, Engenho da Rainha e Tomás Coelho, RJ. Assine agora!">

    <!-- Meta Tags Open Graph para Redes Sociais -->
    <meta property="og:title" content="FireNet Telecom - Internet de Alta Velocidade">
    <meta property="og:description" content="Conexão rápida e estável com planos de até 800 MEGA. Cobertura em Pilares, Inhaúma, Engenho da Rainha e Tomás Coelho, RJ. Confira nossos planos e assine já!">
    <meta property="og:image" content="{{ url_for('static', filename='card_firenet.jpg', _external=True) }}">
    <meta property="og:url" content="{{ url_for('index', _external=True) }}">
    <meta property="og:type" content="website">

    <!-- Meta Tags para Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FireNet Telecom - Internet de Alta Velocidade">
    <meta name="twitter:description" content="Conexão rápida e estável com planos de até 800 MEGA. Cobertura em Pilares, Inhaúma, Engenho da Rainha e Tomás Coelho, RJ. Assine já!">
    <meta name="twitter:image" content="{{ url_for('static', filename='card_firenet.jpg', _external=True) }}">

<style>
  /* Altura aproximada do header (ajuste fino se quiser) */
  :root { --header-h: 80px; }

  /* Garante que qualquer âncora (#id) pare um pouco abaixo do topo */
  section[id], header[id], div[id] {
    scroll-margin-top: var(--header-h);
  }
</style>
</head>

<body>
{% include 'menu_publico.html' %}

<div class="offcanvas offcanvas-end border-0" tabindex="-1" id="menuMobileFirenet" aria-labelledby="menuMobileFirenetLabel">
    <div class="offcanvas-header bg-danger text-white">
        <h5 class="offcanvas-title fw-bold" id="menuMobileFirenetLabel">
            <i class="fas fa-wifi me-2"></i>FireNet Telecom
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="mt-auto text-center pt-4 pb-2">
            <p class="mb-2 text-muted small">Precisa de suporte agora?</p>
            <button class="btn btn-success w-100 py-3 rounded-pill fw-bold shadow-sm" 
                    data-bs-toggle="modal" 
                    data-bs-target="#modalAtendenteVirtual"
                    onclick="fecharMenuMobile()">
                <i class="fab fa-whatsapp me-2 fa-lg"></i> Falar com Atendente
            </button>
        </div>
    </div>

</div>

<main>
<!-- Hero (Imagem de fundo + texto branco) -->
<section id="inicio" class="hero-section text-white text-center">
    <div class="container position-relative">
        <div class="hero-content">
            <h1 class="display-4 fw-bold mb-3">Internet de Alta Velocidade com a FireNet Telecom</h1>
            <p class="lead mb-4">
                A FireNet Telecom oferece a melhor experiência de internet para você, seja para navegar, jogar ou trabalhar.
                Com velocidades de até <strong>800 MEGAS</strong>, garantimos conexão estável e rápida.
            </p>
            <a href="#planos" class="btn btn-danger btn-lg px-5 rounded-pill shadow-lg">Conheça os Planos</a>
        </div>
    </div>
</section>

<!-- Planos (Cards brancos com ícone e botão vermelho) -->
<section id="planos" class="py-5 bg-light">
    <div class="container">
        <h2 class="text-center text-danger mb-2">Nossos Planos</h2>
        <p class="text-center text-muted mb-5 small">
            Escolha o plano que melhor se adapta às suas necessidades. Navegue com ultravelocidade, estabilidade e sem limites de dados o mês inteiro!
        </p>
        <div class="row g-4 justify-content-center">

            <div class="col-lg-4 col-md-6">
                <div class="card plan-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="icon mb-3 text-danger">
                            <i class="fas fa-bolt fa-3x"></i>
                        </div>
                        <h3 class="text-danger fw-bold">1 GIGA</h3>
                        <h4 class="price">R$ 159,99</h4>
                        <button onclick="abrirModalAssinatura('1 GIGA')" class="btn btn-danger w-100 mt-3 rounded-pill">Assinar</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="card plan-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="icon mb-3 text-danger">
                            <i class="fas fa-rocket fa-3x"></i>
                        </div>
                        <h3 class="text-danger fw-bold">700 MEGAS</h3>
                        <h4 class="price">R$ 129,90</h4>
                        <button onclick="abrirModalAssinatura('700 MEGAS')" class="btn btn-danger w-100 mt-3 rounded-pill">Assinar</button>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-6">
                <div class="card plan-card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="icon mb-3 text-danger">
                            <i class="fas fa-tachometer-alt fa-3x"></i>
                        </div>
                        <h3 class="text-danger fw-bold">500 MEGAS</h3>
                        <h4 class="price">R$ 99,90</h4>
                        <button onclick="abrirModalAssinatura('500 MEGAS')" class="btn btn-danger w-100 mt-3 rounded-pill">Assinar</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Taxa de Instalação -->
<div class="mt-5">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-0">
                    <div class="row g-0">
                        
                        <div class="col-md-3 bg-danger bg-opacity-10 d-flex flex-column align-items-center justify-content-center p-4 text-center">
                            <small class="text-uppercase text-danger fw-bold mb-1" style="font-size: 0.8rem;">Taxa de Instalação</small>
                            <h3 class="fw-bold text-danger mb-0">R$ 120,00</h3>
                            <small class="text-muted">Valor único</small>
                        </div>

                        <div class="col-md-9 p-4">
                            <div class="row g-4 align-items-center">
                                
                                <div class="col-lg-6 border-end-lg">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-map-marker-alt text-danger fs-5 mt-1"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="fw-bold text-dark mb-1">Válido para:</h6>
                                            <p class="mb-0 text-muted small">
                                                Pilares, Inhaúma, Engenho da Rainha e Tomás Coelho.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-hand-holding-usd text-danger fs-5 mt-1"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="fw-bold text-dark mb-1">Pagamento Facilitado:</h6>
                                            <p class="mb-0 text-muted small">
                                                Diretamente ao técnico após instalar.<br>
                                                (Aceitamos <strong>Pix</strong> ou <strong>Dinheiro</strong>)
                                            </p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="mt-3 p-4 bg-danger text-white rounded text-center shadow-lg">
            <p class="mb-0 fw-bold">Todos os planos são LIVRES DE FIDELIDADE!</p>
        </div>
    </div>
</section>

<!-- Vantagens -->
<section id="vantagens" class="py-5 bg-white">
    {% include 'cards_vantagens.html' %}
</section>

<!-- Cobertura -->
<section id="cobertura" class="py-5 bg-light">
    <div class="container">
        
        <div class="text-center mb-5">
            <h2 class="text-danger fw-bold">Área de Cobertura</h2>
            <p class="text-muted">Consulte a viabilidade técnica em sua rua agora mesmo.</p>
        </div>

        <div class="card border-0 shadow rounded-4 overflow-hidden bg-white">
            <div class="card-body p-0">
                
                <div class="p-4 p-lg-5 text-center bg-white position-relative" style="z-index: 10;">
                    
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8 col-xl-7">
                            
                            <h3 class="fw-bold mb-3 text-dark">Digite seu CEP</h3>
                            
                            <div class="search-wrapper d-md-flex align-items-center bg-white p-1 rounded-pill-md shadow-sm-md border-md">
                                
                                <div class="text-danger ps-3 d-none d-md-block">
                                    <i class="fas fa-map-marker-alt fa-lg"></i>
                                </div>

                                <input type="text" 
                                       class="form-control form-control-lg border-0 shadow-none bg-transparent ps-md-3 text-center text-md-start mb-3 mb-md-0" 
                                       placeholder="Ex: 20700-000" 
                                       id="ruaSearch" 
                                       maxlength="9"
                                       style="min-height: 50px;">
                                
                                <button class="btn btn-danger btn-lg rounded-pill w-100 w-md-auto px-5 fw-bold" 
                                        id="checkCoverageBtn" 
                                        style="min-height: 50px;">
                                    VERIFICAR
                                </button>
                            </div>

                            <div class="mt-3">
                                <a href="https://buscacepinter.correios.com.br/app/endereco/index.php" target="_blank" class="text-muted text-decoration-none small">
                                    <i class="fas fa-external-link-alt me-1"></i> Não sei meu CEP
                                </a>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="position-relative border-top">
                    <div id="map" class="w-100" style="height: 400px; min-height: 300px;"></div>
                </div>

            </div>
        </div>
    </div>
    
    <input type="hidden" id="ruaEncontrada">

    <style>
        /* Apenas no Desktop (md pra cima), aplicamos o estilo de "Cápsula" */
        @media (min-width: 768px) {
            .rounded-pill-md { border-radius: 50rem !important; }
            .shadow-sm-md { box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important; }
            .border-md { border: 1px solid #dee2e6 !important; }
            .w-md-auto { width: auto !important; }
            .text-md-start { text-align: left !important; }
            .ps-md-3 { padding-left: 1rem !important; }
        }
        
        /* No Mobile, o input ganha uma borda para não ficar solto */
        @media (max-width: 767.98px) {
            #ruaSearch {
                background-color: #f8f9fa !important;
                border: 1px solid #ced4da !important;
                border-radius: 10px;
            }
        }
    </style>
</section>

<div class="modal fade" id="modalCheckAssinatura" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            
            <div class="modal-header bg-danger text-white border-0 rounded-top-4">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-rocket me-2"></i>Quase lá!
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body p-4 text-center">
                
                <div class="mb-4 text-danger opacity-75">
                    <i class="fas fa-map-marked-alt fa-4x animate__animated animate__pulse animate__infinite"></i>
                </div>

                <h4 class="fw-bold text-dark mb-2">Verificar Disponibilidade</h4>
                <p class="text-muted small mb-4">
                    Para ativar seu plano <span class="fw-bold text-danger" id="nomePlanoModal">selecionado</span>, precisamos confirmar se nossa fibra já chega na sua rua.
                </p>
                
                <div class="form-floating mb-3">
                    <input type="text" class="form-control rounded-3 border-danger" id="cepAssinatura" placeholder="00000-000" maxlength="9" style="background-color: #fff5f5;">
                    <label for="cepAssinatura"><i class="fas fa-search me-2 text-muted"></i>Digite seu CEP</label>
                </div>
                
                <button class="btn btn-danger w-100 rounded-pill btn-lg fw-bold shadow-sm" id="btnCheckAssinatura" onclick="checkAssinaturaCep()">
                    CONSULTAR VIABILIDADE
                </button>

                <div id="feedbackAssinatura" class="d-none text-start mt-3 rounded-3 shadow-sm"></div>
            </div>
            
            <div class="modal-footer justify-content-center bg-light border-0 rounded-bottom-4 py-3">
                <small class="text-muted"><i class="fas fa-lock me-1"></i> Site 100% Seguro</small>
            </div>
        </div>
    </div>
</div>

<!-- Cadastro -->
<section id="cadastro" class="py-5 bg-white text-center">
    <div class="container">
        <h2 class="text-danger mb-3">Faça Seu Cadastro</h2>
        <p class="text-muted mb-4">Clique abaixo e torne-se cliente FireNet!</p>
        <a href="/cadastro" class="btn btn-danger btn-lg px-5 rounded-pill shadow-lg">Cadastre-se</a>
    </div>
</section>

<!-- Central do Cliente -->
<section id="central" class="py-5 bg-light text-center">
<div class="container">
        <h2 class="text-danger mb-3">Central do Cliente</h2>
        <p class="text-muted mb-4">Emita boletos, consulte contratos, abra chamados e muito mais.</p>
        <a href="#" data-bs-toggle="modal" data-bs-target="#modalAtendenteVirtual" class="btn btn-danger btn-lg px-5 rounded-pill shadow-lg">Central do Cliente</a>
    </div>
</section>
</main>

{% include 'footer.html' %}

{% include 'whatsapp_widget.html' %}

{% if aviso_global %}
<div class="modal fade" id="modalAvisoGlobal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true" style="z-index: 10000;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
            
            <div class="modal-header border-0 bg-danger text-white d-flex flex-column align-items-center py-4">
                
                <img src="{{ url_for('static', filename='logo.png') }}" 
                     alt="FireNet" 
                     class="mb-3" 
                     style="height: 50px; filter: brightness(0) invert(1); object-fit: contain;">
                
                <h5 class="modal-title fw-bold text-uppercase text-center px-3">
                    {% if aviso_global.tipo == 'urgente' %}
                        <i class="fas fa-exclamation-triangle me-2 text-warning"></i> {% elif aviso_global.tipo == 'alerta' %}
                        <i class="fas fa-exclamation-circle me-2"></i>
                    {% else %}
                        <i class="fas fa-bullhorn me-2"></i>
                    {% endif %}
                    {{ aviso_global.titulo }}
                </h5>
            </div>
            
            <div class="modal-body p-4 text-center">
                <p class="fs-5 text-secondary mb-0" style="white-space: pre-wrap; line-height: 1.6;">{{ aviso_global.mensagem }}</p>
            </div>
            
            <div class="modal-footer border-0 bg-light justify-content-center pb-4">
                <button type="button" class="btn btn-danger px-5 rounded-pill fw-bold shadow-sm" onclick="fecharAvisoGlobal()">
                    CIENTE
                </button>
            </div>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const avisoId = "{{ aviso_global.id }}";
        // Verifica se já foi visto nesta sessão
        const jaVisto = sessionStorage.getItem('aviso_visto_' + avisoId);

        if (!jaVisto) {
            const modalElement = document.getElementById('modalAvisoGlobal');
            const myModal = new bootstrap.Modal(modalElement);
            
            myModal.show();
            
            // 1. TRAVAR ROLAGEM FORÇADA (CSS inline no body e html)
            document.body.style.overflow = 'hidden';
            document.documentElement.style.overflow = 'hidden';
            document.body.style.height = '100vh'; // Garante que não role mesmo
            
            // 2. ESCURECER O FUNDO (Backdrop)
            // Pequeno delay para garantir que o elemento backdrop foi criado
            setTimeout(() => {
                const backdrops = document.querySelectorAll('.modal-backdrop');
                backdrops.forEach(bd => {
                    bd.style.opacity = '0.96'; // Quase preto
                    bd.style.backgroundColor = '#000';
                    bd.style.zIndex = '9999'; // Garante que fique acima de tudo, menos do modal
                });
            }, 50);

            // Marca como visto
            sessionStorage.setItem('aviso_visto_' + avisoId, 'true');
        }
    });

    function fecharAvisoGlobal() {
        // Libera a rolagem novamente
        document.body.style.overflow = '';
        document.documentElement.style.overflow = '';
        document.body.style.height = '';
        
        // Fecha o modal via Bootstrap
        const modalElement = document.getElementById('modalAvisoGlobal');
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        if (modalInstance) {
            modalInstance.hide();
        }
    }
</script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  (function () {
    const header = document.querySelector('header');
    const navMobile = document.getElementById('navMobile');
    const headerH = header ? header.offsetHeight : 80;

    function smoothScrollTo(hash) {
      if (!hash || hash === '#') return;
      const el = document.querySelector(hash);
      if (!el) return;
      // Calcula a posição alvo compensando o header fixo
      const y = el.getBoundingClientRect().top + window.pageYOffset - headerH;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }

    // Fechar o menu mobile e só depois rolar
    function handleAnchorClick(e) {
      const href = this.getAttribute('href') || '';
      if (!href.startsWith('#')) return;

      e.preventDefault();

      // Se o menu mobile está aberto, esconde e rola após o colapso
      const isMobileOpen = navMobile && navMobile.classList.contains('show');
      if (isMobileOpen) {
        const bsCollapse = bootstrap.Collapse.getOrCreateInstance(navMobile, { toggle: false });
        const once = () => {
          navMobile.removeEventListener('hidden.bs.collapse', once);
          // Pequeno timeout para garantir layout estabilizado
          setTimeout(() => smoothScrollTo(href), 0);
        };
        navMobile.addEventListener('hidden.bs.collapse', once);
        bsCollapse.hide();
      } else {
        smoothScrollTo(href);
      }
    }

    // Links do menu desktop e do menu mobile
    document.querySelectorAll('nav a[href^="#"]').forEach(a => {
      a.addEventListener('click', handleAnchorClick);
    });

    // (Opcional) Botões/links dentro da página que levam a #âncoras (ex.: “Assinar”)
    document.querySelectorAll('a.btn[href^="#"]').forEach(a => {
      a.addEventListener('click', handleAnchorClick);
    });
  })();
</script>

<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&libraries=places&callback=initMap" async defer></script>

<script>
    let map;
    let geocoder;
    let marker = null;
    
    // Variável para guardar o plano selecionado no clique do botão "Assinar"
    let planoParaAssinar = '';

    // --- 1. Inicialização do Mapa (Lógica Existente) ---
    function initMap() {
        geocoder = new google.maps.Geocoder();
        const mapEl = document.getElementById('map');
        if (!mapEl) return;

        map = new google.maps.Map(mapEl, {
            center: {lat: -22.889, lng: -43.289},
            zoom: 13
        });

        map.addListener('click', function(event) {
            geocoder.geocode({ location: event.latLng }, function(results, status) {
                if (status === 'OK' && results[0]) {
                    Swal.fire({
                        title: 'Local Selecionado',
                        text: 'Verificar cobertura neste ponto do mapa?',
                        showCancelButton: true,
                        confirmButtonText: 'Verificar',
                        confirmButtonColor: '#dc3545'
                    }).then((result) => {
                        if (result.isConfirmed) {
                             let ruaGoogle = '';
                             let bairroGoogle = '';
                             results[0].address_components.forEach(comp => {
                                if (comp.types.includes('route')) ruaGoogle = comp.long_name;
                                if (comp.types.includes('sublocality')) bairroGoogle = comp.long_name;
                             });
                             validarNoBackend(ruaGoogle, bairroGoogle, null);
                        }
                    });
                    if (marker) marker.setMap(null);
                    marker = new google.maps.Marker({ position: event.latLng, map: map });
                }
            });
        });
    }

    // --- 2. Lógica da Busca Principal (Mapa) ---
    const ruaSearch = document.getElementById('ruaSearch');
    if (ruaSearch) {
        // Máscara
        ruaSearch.addEventListener('input', function (e) {
            let v = e.target.value.replace(/\D/g, "");
            if (v.length > 5) v = v.substring(0, 5) + "-" + v.substring(5, 8);
            e.target.value = v;
        });
        // Enter Key
        ruaSearch.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') { event.preventDefault(); checkCoverage(); }
        });
    }

    async function checkCoverage() {
        const inputEl = document.getElementById('ruaSearch');
        if (!inputEl) return;
        let cep = inputEl.value.replace(/\D/g, '');

        if (cep.length !== 8) {
            Swal.fire({ title: 'CEP Inválido', text: 'Digite 8 dígitos.', icon: 'warning', confirmButtonColor: '#dc3545' });
            return;
        }

        Swal.showLoading();
        try {
            const r = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const d = await r.json();
            if (d.erro) { Swal.fire({ title: 'CEP não encontrado', icon: 'error', confirmButtonColor: '#dc3545' }); return; }

            if (geocoder && map) {
                geocoder.geocode({ 'address': `${d.logradouro}, ${d.bairro}, ${d.localidade} - ${d.uf}` }, function(results, status) {
                    if (status === 'OK') {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(17);
                        if (marker) marker.setMap(null);
                        marker = new google.maps.Marker({ map: map, position: results[0].geometry.location });
                    }
                });
            }
            validarNoBackend(d.logradouro, d.bairro, cep);
        } catch (e) {
            console.error(e);
            Swal.fire({ title: 'Erro', text: 'Erro ao consultar CEP.', icon: 'error', confirmButtonColor: '#dc3545' });
        }
    }

    function validarNoBackend(rua, bairro, cep = null) {
        if (!Swal.isVisible()) Swal.showLoading();
        fetch('/validar_cobertura', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ rua: rua, bairro: bairro })
        })
        .then(r => r.json())
        .then(data => {
            if (data.link) {
                Swal.fire({
                    title: 'Cobertura Disponível!',
                    html: `Viabilidade em <b>${rua}</b>!<br>Cadastre-se agora.`,
                    icon: 'success',
                    confirmButtonColor: '#dc3545',
                    confirmButtonText: 'Cadastre-se agora',
                    showCloseButton: true
                }).then(result => {
                    if (result.isConfirmed) {
                        let destino = data.link;
                        if (cep) destino += (destino.includes('?') ? '&' : '?') + `cep=${cep}`;
                        window.location.href = destino;
                    }
                });
            } else {
                Swal.fire({ title: 'Sem Cobertura', html: `Sem viabilidade para <b>${rua}</b> no momento.`, icon: 'info', confirmButtonColor: '#dc3545' });
            }
        })
        .catch(() => Swal.fire({ title: 'Erro', text: 'Erro de conexão.', icon: 'error', confirmButtonColor: '#dc3545' }));
    }

    const btnCoverage = document.getElementById('checkCoverageBtn');
    if (btnCoverage) btnCoverage.addEventListener('click', checkCoverage);


    // --- 3. NOVA LÓGICA: Modal de Assinatura (Planos) ---
    
    // Função chamada pelos botões "Assinar"
    function abrirModalAssinatura(plano) {
        planoParaAssinar = plano;
        
        // Atualiza o texto visual do modal (NOVO)
        const spanPlano = document.getElementById('nomePlanoModal');
        if (spanPlano) spanPlano.innerText = plano;

        const modalEl = document.getElementById('modalCheckAssinatura');
        const modal = new bootstrap.Modal(modalEl);
        
        // Limpa estado anterior
        document.getElementById('cepAssinatura').value = '';
        const feedback = document.getElementById('feedbackAssinatura');
        feedback.className = 'd-none'; // Esconde
        feedback.innerHTML = ''; // Limpa texto
        
        modal.show();
        
        modalEl.addEventListener('shown.bs.modal', () => {
            document.getElementById('cepAssinatura').focus();
        });
    }

    // Função para fechar o menu mobile automaticamente ao clicar em um link
    function fecharMenuMobile() {
        const menuEl = document.getElementById('menuMobileFirenet');
        const bsOffcanvas = bootstrap.Offcanvas.getInstance(menuEl); // Pega a instância aberta
        if (bsOffcanvas) {
            bsOffcanvas.hide();
        }
    }

    // Configura input do Modal (Máscara e Enter)
    const cepModalInput = document.getElementById('cepAssinatura');
    if (cepModalInput) {
        cepModalInput.addEventListener('input', function (e) {
            let v = e.target.value.replace(/\D/g, "");
            if (v.length > 5) v = v.substring(0, 5) + "-" + v.substring(5, 8);
            e.target.value = v;
        });
        
        cepModalInput.addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                checkAssinaturaCep();
            }
        });
    }

    async function checkAssinaturaCep() {
        const cepInput = document.getElementById('cepAssinatura');
        const cep = cepInput.value.replace(/\D/g, '');
        const feedback = document.getElementById('feedbackAssinatura');
        const btn = document.getElementById('btnCheckAssinatura');
        const originalText = btn.innerHTML; // Guarda o texto original do botão

        // Limpa feedback anterior
        feedback.className = 'd-none';
        
        if (cep.length !== 8) {
            // Adicionado mt-4 para desgrudar do botão
            feedback.className = 'alert alert-warning mt-4 shadow-sm';
            feedback.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>CEP inválido. Digite 8 números.';
            feedback.classList.remove('d-none');
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';

        try {
            // 1. Busca no ViaCEP para pegar Rua e Bairro
            const r1 = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
            const d1 = await r1.json();
            
            if (d1.erro) throw new Error('CEP inexistente');

            // 2. Validação no Backend da FireNet
            const r2 = await fetch('/validar_cobertura', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rua: d1.logradouro, bairro: d1.bairro })
            });
            const d2 = await r2.json();

            if (d2.link) {
                // SUCESSO
                feedback.className = 'alert alert-success mt-4 shadow-sm border-0';
                feedback.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle fa-2x me-3"></i>
                        <div>
                            <strong>Cobertura confirmada!</strong><br>
                            Redirecionando para o cadastro...
                        </div>
                    </div>`;
                feedback.classList.remove('d-none');
                
                setTimeout(() => {
                    const url = `/cadastro?cep=${cep}&plano=${encodeURIComponent(planoParaAssinar)}`;
                    window.location.href = url;
                }, 1500);

            } else {
                // SEM COBERTURA
                feedback.className = 'alert alert-danger mt-4 shadow-sm border-0';
                feedback.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-times-circle fa-2x me-3"></i>
                        <div>
                            <strong>Sem viabilidade técnica.</strong><br>
                            Ainda não atendemos a rua <b>${d1.logradouro}</b>.
                        </div>
                    </div>`;
                feedback.classList.remove('d-none');
                
                // Restaura o botão
                btn.disabled = false;
                btn.innerHTML = originalText;
            }

        } catch (e) {
            // ERRO / CEP NÃO ENCONTRADO
            feedback.className = 'alert alert-warning mt-4 shadow-sm border-0';
            feedback.innerHTML = '<i class="fas fa-search-location me-2"></i>Não conseguimos localizar este CEP.';
            feedback.classList.remove('d-none');
            
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
    }

    window.initMap = initMap;
</script>

</body>
</html>
